预设 2：字节跳动 豆包（火山方舟 Ark）
图片生成 API（Seedream 4.0 API）
最近更新时间：2025.10.11 19:03:55
首次发布时间：2025.05.13 17:18:46

## 概述与模型

### 支持模型简介

#### doubao-seedream-4.0（即梦4.0）
- **Model ID**: `doubao-seedream-4-0-250828`
- **版本**: 250828
- **能力**:
  - 文生图（text-to-image）
  - 图生图（image-to-image，包括单图、多参考图）
  - 生成组图（sequential/grouped generation：文生组图、单张图生组图、多参考图生组图）
  - 单张图生图或生成组图两种工作模式（通过 sequential_image_generation 参数切换）
- **限流**: IPM（每分钟）限流 500 张/分钟
- **定价**: 图片生成模型计费

#### doubao-seedream-3.0-t2i
- **能力**: 文生图（text-to-image 单张）
- **Model ID 样例**: `doubao-seedream-3-0-t2i-250415`

#### doubao-seededit-3.0-i2i
- **能力**: 图生图（image-to-image 单张编辑）
- **Model ID 样例**: `doubao-seededit-3-0-i2i-250628`

## REST 接口

### HTTP 方法与 URL
```
POST https://ark.cn-beijing.volces.com/api/v3/images/generations
```

### 请求头
```
Content-Type: application/json
Authorization: Bearer $ARK_API_KEY
```

## 示例

### 豆包4.0（文生图）
```bash
curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ARK_API_KEY" \
  -d '{
    "model": "doubao-seedream-4-0-250828",
    "prompt": "星际穿越，黑洞，黑洞里冲出一辆快支离破碎的复古列车，抢视觉冲击力，电影大片，末日既视感，动感，对比色，oc渲染，光线追踪，动态模糊，景深，超现实主义，深蓝，画面通过细腻的丰富的色彩层次塑造主体与场景，质感真实，暗黑风背景的光影效果营造出氛围，整体兼具艺术幻想感，夸张的广角透视效果，耀光，反射，极致的光影，强引力，吞噬",
    "size": "2K",
    "sequential_image_generation": "disabled",
    "stream": false,
    "response_format": "url",
    "watermark": true
  }'
```

**返回示例：**
```json
{
  "model": "doubao-seedream-4-0-250828",
  "created": 1757321139,
  "data": [
    {
      "url": "https://...",
      "size": "3104x1312"
    }
  ],
  "usage": {
    "generated_images": 1,
    "output_tokens": 123,
    "total_tokens": 123
  }
}
```

### 豆包4.0（图生图）
```bash
curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ARK_API_KEY" \
  -d '{
    "model": "doubao-seedream-4-0-250828",
    "prompt": "生成狗狗趴在草地上的近景画面",
    "image": "https://ark-project.tos-cn-beijing.volces.com/doc_image/seedream4_imageToimage.png",
    "size": "2K",
    "sequential_image_generation": "disabled",
    "stream": false,
    "response_format": "url",
    "watermark": true
  }'
```

### 豆包4.0 流式输出示例（组图生成）
```bash
curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ARK_API_KEY" \
  -d '{
    "model": "doubao-seedream-4-0-250828",
    "prompt": "参考这个LOGO，做一套户外运动品牌视觉设计，品牌名称为GREEN，包括包装袋、帽子、纸盒、手环、挂绳等。绿色视觉主色调，趣味、简约现代风格",
    "image": "https://ark-project.tos-cn-beijing.volces.com/doc_image/seedream4_imageToimages.png",
    "sequential_image_generation": "auto",
    "sequential_image_generation_options": { "max_images": 3 },
    "size": "2K",
    "stream": true
  }'
```

**流式返回示例（SSE 事件）：**
```
event: image_generation.partial_succeeded
data: {
  "type": "image_generation.partial_succeeded",
  "model": "doubao-seedream-4-0-250828",
  "created": 1757396757,
  "image_index": 0,
  "url": "https://...",
  "size": "2496x1664"
}

event: image_generation.completed
data: {
  "type": "image_generation.completed",
  "model": "doubao-seedream-4-0-250828",
  "created": 1757396825,
  "usage": {
    "generated_images": 3,
    "output_tokens": 48672,
    "total_tokens": 48672
  }
}
data: [DONE]
```

### 即梦3.0 文生图示例
```bash
curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ARK_API_KEY" \
  -d '{
    "model": "doubao-seedream-3-0-t2i-250415",
    "prompt": "鱼眼镜头，一只猫咪的头部，画面呈现出猫咪的五官因为拍摄方式扭曲的效果。",
    "response_format": "url",
    "size": "1024x1024",
    "seed": 12,
    "guidance_scale": 2.5,
    "watermark": true
  }'
```

### 即梦3.0 图生图示例
```bash
curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ARK_API_KEY" \
  -d '{
    "model": "doubao-seededit-3-0-i2i-250628",
    "prompt": "改成爱心形状的泡泡",
    "image": "https://ark-project.tos-cn-beijing.volces.com/doc_image/seededit_i2i.jpeg",
    "response_format": "url",
    "size": "adaptive",
    "seed": 21,
    "guidance_scale": 5.5,
    "watermark": true
  }'
```

## 请求参数详解

### model (string) 必选
本次请求使用的 Model ID 或推理接入点 (Endpoint ID)。

### prompt (string) 必选
- 用于生成图像的提示词，支持中英文
- 建议：不超过 300 个汉字或 600 个英文单词（过长会分散信息、导致模型忽略细节）

### image (string 或 array) 可选
- 仅 doubao-seedream-4.0、doubao-seededit-3.0-i2i 支持
- 支持 URL 或 Base64 编码
- doubao-seedream-4.0 支持单图或多图输入（最多 10 张参考图）
- doubao-seededit-3.0-i2i 仅支持单图输入
- **格式要求**:
  - Base64 格式：`data:image/<格式>;base64,` （<格式>必须小写）
  - 图片格式：jpeg、png
  - 宽高比范围：[1/3, 3]
  - 尺寸要求：宽/高 > 14px
  - 文件大小：≤ 10MB
  - 总像素：≤ 6000×6000px
- **多图限制**：参考图数量 + 最终生成图片数量 ≤ 15 张

### size (string) 可选
指定图片宽高/分辨率，如 "2K", "1024x1024", "2048x2048" 等

### seed (integer) 可选
- 仅 doubao-seedream-3.0-t2i、doubao-seededit-3.0-i2i 支持
- 默认值：-1
- 取值范围：[-1, 2147483647]
- seed=-1 或不指定时使用随机数，相同 seed 值结果倾向相似

### sequential_image_generation (string) 可选
- 仅 doubao-seedream-4.0 支持
- 默认值：disabled
- 控制是否开启"组图"功能
- 取值：
  - `auto`：自动判断模式，模型根据提示词判断是否返回组图
  - `disabled`：关闭组图功能，仅生成一张图

### sequential_image_generation_options (object) 可选
- 当 sequential_image_generation = auto 时生效
- 字段：`max_images` - 最多生成图片数量

### stream (Boolean) 可选
- 仅 doubao-seedream-4.0 支持
- 默认：false
- 控制是否开启流式输出（Server-Sent Events）
- `false`：等待所有图片完成后一次性返回
- `true`：开启流式模式，生成每张图片时即时返回事件

### guidance_scale (Float) 可选
- 控制模型输出与 prompt 的一致程度（文本权重）
- 值越大输出和 prompt 越一致，自由度越小
- 默认值：
  - doubao-seedream-3.0-t2i：2.5
  - doubao-seededit-3.0-i2i：5.5
  - doubao-seedream-4.0：不支持
- 取值范围：[1, 10]

### response_format (string) 可选
- 默认值：url
- 指定返回图片格式：
  - `url`：返回图片下载链接（24小时有效）
  - `b64_json`：返回 Base64 编码字符串

### watermark (Boolean) 可选
- 默认值：true
- 是否在生成图片右下角添加"AI生成"水印

## 响应参数（非流式）

### 成功响应
```json
{
  "model": "doubao-seedream-4-0-250828",
  "created": 1757321139,
  "data": [
    {
      "url": "https://...",
      "size": "3104x1312"
    }
  ],
  "usage": {
    "generated_images": 1,
    "output_tokens": 123,
    "total_tokens": 123
  }
}
```

### 字段说明
- **model**: 本次请求使用的模型 ID
- **created**: Unix 时间戳（秒）
- **data**: 输出图像信息数组
  - `url`: 图片下载链接（当 response_format = url）
  - `b64_json`: Base64 编码（当 response_format = b64_json）
  - `size`: 格式 "<宽像素>x<高像素>"
- **usage**: 用量信息
  - `generated_images`: 成功生成的图片张数
  - `output_tokens`: sum(图片长 × 图片宽) / 256，取整
  - `total_tokens`: 与 output_tokens 相同（当前不计算输入 token）

### 错误响应
```json
{
  "error": {
    "code": "BadRequest",
    "message": "The request failed because it is missing one or multiple required parameters. Request ID: {id}"
  }
}
```

## 流式响应（仅 doubao-seedream-4.0）

当 `stream = true` 时，服务器以 SSE 推送事件：

### 1. image_generation.partial_succeeded
单张图片生成成功时返回：
```json
{
  "type": "image_generation.partial_succeeded",
  "model": "doubao-seedream-4-0-250828",
  "created": 1589478378,
  "image_index": 0,
  "url": "https://...",
  "size": "2048×2048"
}
```

### 2. image_generation.partial_failed
单张图片生成失败时返回：
```json
{
  "type": "image_generation.partial_failed",
  "model": "doubao-seedream-4-0-250828",
  "created": 1589478378,
  "image_index": 2,
  "error": {
    "code": "OutputImageSensitiveContentDetected",
    "message": "The request failed because the output image may contain sensitive information."
  }
}
```

### 3. image_generation.completed
所有图片处理完毕后返回（流式最后事件）：
```json
{
  "type": "image_generation.completed",
  "model": "doubao-seedream-4-0-250828",
  "created": 1589478378,
  "usage": {
    "generated_images": 2,
    "output_tokens": 123,
    "total_tokens": 123
  }
}
```

## 组图场景特殊说明

在组图生成中，当某张图生成失败：
- **审核不通过（敏感内容）**：继续生成下一张图片
- **内部服务异常（500）**：停止后续图片生成

## 用量计算

- `output_tokens = sum(图片长 × 图片宽) / 256`，取整
- `total_tokens = output_tokens`（当前不计算输入 token）
- `generated_images`：仅统计成功生成的图片（失败不计费）

## 典型请求示例

### 完整参数示例
```json
{
  "model": "doubao-seedream-4-0-250828",
  "prompt": "一只可爱的小猫在花园里玩耍",
  "image": "https://example.com/reference.jpg",
  "size": "2K",
  "sequential_image_generation": "auto",
  "sequential_image_generation_options": { "max_images": 4 },
  "stream": false,
  "response_format": "url",
  "watermark": true,
  "seed": 123,
  "guidance_scale": 2.5
}
```

## 注意事项

1. **流式功能**需要使用最新版本 SDK
2. **图片 URL** 必须可访问，Base64 编码格式必须正确
3. **guidance_scale** 仅在 3.0 系列模型中支持，4.0 不支持
4. **组图功能** 仅在 4.0 模型中支持
5. **多图输入** 最多支持 10 张参考图
6. **图片链接** 24 小时后失效，请及时下载保存

## OpenAPI 规范

### Chat API (文本)
```yaml
paths:
  /api/v3/chat/completions:
    post:
      summary: 对话(Chat)-文本 API
      parameters:
        - name: Authorization
          in: header
          required: true
          example: Bearer {{ARK_API_KEY}}
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                model:
                  type: string
                  example: "doubao-pro-32k-240615"
                messages:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      content:
                        type: string
```

### Chat API (视觉)
```yaml
paths:
  /api/v3/chat/completions:
    post:
      summary: 对话(Chat)-视觉 API
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                model:
                  type: string
                  example: "doubao-vision-pro-32k-2410128"
                messages:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      content:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                            text:
                              type: string
                            image_url:
                              type: object
                              properties:
                                url:
                                  type: string
```