<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana å¤šå›¾ç‰‡æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">
            ğŸŒ Nano Banana å¤šå›¾ç‰‡ç”Ÿæˆæµ‹è¯•
        </h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">æµ‹è¯•åœºæ™¯ï¼šHTML ç”ŸæˆåŒ…å«å¤šå¼ å›¾ç‰‡</h2>
            <p class="text-gray-600 mb-4">
                æ¨¡æ‹Ÿå®é™… HTML ç”Ÿæˆåœºæ™¯ï¼Œå…¶ä¸­åŒ…å«å¤šå¼ å›¾ç‰‡å ä½ç¬¦éœ€è¦åŒæ—¶ç”Ÿæˆã€‚
                è¿™å°†æµ‹è¯• Nano Banana åœ¨å¹¶å‘å¤„ç†å¤šä¸ªæç¤ºè¯æ—¶çš„è¡¨ç°ã€‚
            </p>
            
            <button 
                id="testMultipleImages" 
                class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                onclick="testMultipleImageGeneration()">
                å¼€å§‹æµ‹è¯•å¤šå›¾ç‰‡ç”Ÿæˆ
            </button>
        </div>

        <div id="results" class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-lg font-semibold mb-4">æµ‹è¯•ç»“æœï¼š</h3>
            <div id="testStatus" class="text-gray-600">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
            <div id="imageResults" class="grid md:grid-cols-2 gap-4 mt-6"></div>
        </div>
    </div>

    <script>
        async function testMultipleImageGeneration() {
            const testButton = document.getElementById('testMultipleImages');
            const testStatus = document.getElementById('testStatus');
            const imageResults = document.getElementById('imageResults');
            
            testButton.disabled = true;
            testButton.textContent = 'æµ‹è¯•ä¸­...';
            testStatus.textContent = 'æ­£åœ¨åŒæ—¶ç”Ÿæˆå¤šå¼ å›¾ç‰‡...';
            imageResults.innerHTML = '';

            // æ¨¡æ‹Ÿ HTML ç”Ÿæˆåœºæ™¯ä¸­çš„å¤šä¸ªå›¾ç‰‡æç¤ºè¯
            const imagePrompts = [
                {
                    id: 1,
                    prompt: "Modern office building with glass facade and professional architecture",
                    alt: "Company headquarters building"
                },
                {
                    id: 2, 
                    prompt: "Diverse professional team working together around a conference table",
                    alt: "Team collaboration meeting"
                },
                {
                    id: 3,
                    prompt: "High-tech computer setup with multiple monitors and modern workspace",
                    alt: "Professional workstation setup"
                },
                {
                    id: 4,
                    prompt: "Business handshake between professionals in corporate setting",
                    alt: "Business partnership agreement"
                },
                {
                    id: 5,
                    prompt: "Modern office interior with open space and collaborative work areas", 
                    alt: "Contemporary office environment"
                }
            ];

            try {
                testStatus.textContent = `æ­£åœ¨å¹¶å‘ç”Ÿæˆ ${imagePrompts.length} å¼ å›¾ç‰‡...`;
                
                // ğŸš€ å¹¶å‘å‘é€æ‰€æœ‰å›¾ç‰‡ç”Ÿæˆè¯·æ±‚ - æµ‹è¯• Nano Banana çš„å¹¶å‘å¤„ç†èƒ½åŠ›
                const startTime = Date.now();
                const promises = imagePrompts.map(async (imagePrompt, index) => {
                    const individualStartTime = Date.now();
                    
                    // æ·»åŠ å•ä¸ªå›¾ç‰‡çš„çŠ¶æ€æ˜¾ç¤º
                    const statusDiv = document.createElement('div');
                    statusDiv.id = `status-${imagePrompt.id}`;
                    statusDiv.className = 'bg-gray-50 p-4 rounded mb-2';
                    statusDiv.innerHTML = `
                        <h4 class="font-semibold">å›¾ç‰‡ ${imagePrompt.id}: ${imagePrompt.alt}</h4>
                        <p class="text-sm text-gray-600">ğŸ”„ ç”Ÿæˆä¸­...</p>
                    `;
                    imageResults.appendChild(statusDiv);
                    
                    try {
                        const response = await axios.post('/api/generate/nano-banana', {
                            prompt: imagePrompt.prompt,
                            apiKey: 'AIzaSyDN2lwEGnpNqUZUQB21y8QGuM-PHN2KG8c',
                            outputFormat: 'base64',
                            aspectRatio: '16:9'
                        });
                        
                        const individualDuration = Date.now() - individualStartTime;
                        
                        if (response.data.success) {
                            statusDiv.innerHTML = `
                                <h4 class="font-semibold text-green-600">âœ… å›¾ç‰‡ ${imagePrompt.id}: ${imagePrompt.alt}</h4>
                                <p class="text-sm text-gray-600">ç”Ÿæˆæ—¶é—´: ${individualDuration}ms</p>
                                <p class="text-sm text-gray-600">æç¤ºè¯: "${imagePrompt.prompt}"</p>
                                <div class="mt-2">
                                    <img src="${response.data.imageUrl}" 
                                         alt="${imagePrompt.alt}" 
                                         class="w-full h-32 object-cover rounded"
                                         loading="lazy">
                                </div>
                            `;
                            return {
                                success: true,
                                id: imagePrompt.id,
                                duration: individualDuration,
                                prompt: imagePrompt.prompt
                            };
                        } else {
                            throw new Error(response.data.error || 'Generation failed');
                        }
                    } catch (error) {
                        const individualDuration = Date.now() - individualStartTime;
                        statusDiv.innerHTML = `
                            <h4 class="font-semibold text-red-600">âŒ å›¾ç‰‡ ${imagePrompt.id}: ${imagePrompt.alt}</h4>
                            <p class="text-sm text-red-600">é”™è¯¯: ${error.message}</p>
                            <p class="text-sm text-gray-600">è€—æ—¶: ${individualDuration}ms</p>
                        `;
                        return {
                            success: false,
                            id: imagePrompt.id,
                            error: error.message,
                            duration: individualDuration
                        };
                    }
                });

                // ç­‰å¾…æ‰€æœ‰å›¾ç‰‡ç”Ÿæˆå®Œæˆ
                const results = await Promise.all(promises);
                const totalDuration = Date.now() - startTime;
                
                // ç»Ÿè®¡ç»“æœ
                const successful = results.filter(r => r.success).length;
                const failed = results.filter(r => !r.success).length;
                const averageDuration = results.reduce((sum, r) => sum + r.duration, 0) / results.length;
                
                testStatus.innerHTML = `
                    <div class="space-y-2">
                        <h3 class="font-semibold text-lg">ğŸ“Š æµ‹è¯•å®Œæˆç»Ÿè®¡</h3>
                        <p><span class="font-medium">æ€»è€—æ—¶:</span> ${totalDuration}ms (${(totalDuration/1000).toFixed(2)}ç§’)</p>
                        <p><span class="font-medium">æˆåŠŸç”Ÿæˆ:</span> ${successful}/${imagePrompts.length} å¼ å›¾ç‰‡</p>
                        <p><span class="font-medium">å¤±è´¥:</span> ${failed} å¼ å›¾ç‰‡</p>
                        <p><span class="font-medium">å¹³å‡å•å›¾ç”Ÿæˆæ—¶é—´:</span> ${averageDuration.toFixed(0)}ms</p>
                        <p><span class="font-medium">å¹¶å‘æ•ˆæœ:</span> 
                           ${successful > 0 ? 'âœ… Nano Banana æ”¯æŒå¹¶å‘å¤šå›¾ç‰‡ç”Ÿæˆ' : 'âŒ å¹¶å‘å¤„ç†å­˜åœ¨é—®é¢˜'}
                        </p>
                    </div>
                `;

                console.log('ğŸŒ Nano Banana å¤šå›¾ç‰‡å¹¶å‘æµ‹è¯•ç»“æœ:', {
                    totalDuration,
                    successful,
                    failed,
                    averageDuration,
                    results
                });

            } catch (error) {
                testStatus.innerHTML = `
                    <div class="text-red-600">
                        <h3 class="font-semibold">âŒ æµ‹è¯•å¤±è´¥</h3>
                        <p>é”™è¯¯: ${error.message}</p>
                    </div>
                `;
            } finally {
                testButton.disabled = false;
                testButton.textContent = 'é‡æ–°æµ‹è¯•å¤šå›¾ç‰‡ç”Ÿæˆ';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè¯´æ˜
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸŒ Nano Banana å¤šå›¾ç‰‡æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“ æµ‹è¯•ç›®çš„: éªŒè¯ Nano Banana åœ¨ HTML ç”Ÿæˆåœºæ™¯ä¸­çš„å¤šå›¾ç‰‡å¹¶å‘å¤„ç†èƒ½åŠ›');
        });
    </script>
</body>
</html>