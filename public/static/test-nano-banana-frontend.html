<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana å‰ç«¯è°ƒç”¨æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸŒ Nano Banana å‰ç«¯è°ƒç”¨æµ‹è¯•</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">æ¨¡æ‹Ÿå‰ç«¯ NanoBananaService è°ƒç”¨</h2>
            
            <button onclick="testNanoBananaService()" id="testBtn" 
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mb-4">
                ğŸŒ æµ‹è¯• NanoBananaService
            </button>
            
            <div id="result" class="mb-4"></div>
            <div id="imageContainer"></div>
        </div>
        
        <div class="bg-gray-50 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ è°ƒè¯•æ—¥å¿—</h2>
            <pre id="debugLog" class="text-xs bg-black text-green-400 p-4 rounded-lg h-64 overflow-y-auto"></pre>
        </div>
    </div>

    <script>
        function log(message) {
            const logContainer = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.textContent += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        // æ¨¡æ‹Ÿ NanoBananaService çš„è°ƒç”¨
        async function testNanoBananaService() {
            const testBtn = document.getElementById('testBtn');
            const result = document.getElementById('result');
            const imageContainer = document.getElementById('imageContainer');
            
            testBtn.disabled = true;
            testBtn.textContent = 'ğŸ”„ æµ‹è¯•ä¸­...';
            result.innerHTML = '';
            imageContainer.innerHTML = '';
            
            try {
                log('ğŸŒ å¼€å§‹æ¨¡æ‹Ÿ NanoBananaService.generateImage è°ƒç”¨');
                
                // æ¨¡æ‹Ÿé…ç½®å¯¹è±¡
                const config = {
                    apiKey: 'AIzaSyDN2lwEGnpNqUZUQB21y8QGuM-PHN2KG8c',
                    basePromptStyle: 'photorealistic',
                    styleEnhancement: 'professional',
                    outputFormat: 'base64'
                };
                
                const altText = 'A professional coffee shop interior with modern furniture';
                
                log(`âš™ï¸ é…ç½®: ${JSON.stringify(config)}`);
                log(`ğŸ“ Altæ–‡æœ¬: ${altText}`);
                
                // æ„å»ºå¢å¼ºæç¤ºè¯ï¼ˆæ¨¡æ‹Ÿ buildEnhancedPromptï¼‰
                let enhancedPrompt = altText;
                
                const baseStyles = {
                    'photorealistic': 'photorealistic editorial photo, natural daylight, 50â€“85mm look, gentle depth of field, true-to-life color'
                };
                
                const enhancements = {
                    'professional': 'neutral palette, balanced composition, soft frontal lighting, crisp detail'
                };
                
                if (config.basePromptStyle && baseStyles[config.basePromptStyle]) {
                    enhancedPrompt += ', ' + baseStyles[config.basePromptStyle];
                }
                
                if (config.styleEnhancement && enhancements[config.styleEnhancement]) {
                    enhancedPrompt += ', ' + enhancements[config.styleEnhancement];
                }
                
                log(`âœ¨ å¢å¼ºåçš„æç¤ºè¯: "${enhancedPrompt}"`);
                
                // æ¨¡æ‹Ÿå‰ç«¯è°ƒç”¨åç«¯
                log('ğŸ”— è°ƒç”¨åç«¯ API: /api/generate/nano-banana');
                
                const response = await fetch('/api/generate/nano-banana', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: config.apiKey,
                        prompt: enhancedPrompt,
                        outputFormat: config.outputFormat
                    })
                });
                
                log(`ğŸ“¡ API å“åº”çŠ¶æ€: ${response.status}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API è°ƒç”¨å¤±è´¥ (${response.status}): ${errorText}`);
                }
                
                const responseData = await response.json();
                log(`ğŸ“Š å“åº”æ•°æ®: success=${responseData.success}, imageUrlé•¿åº¦=${responseData.imageUrl?.length || 0}`);
                
                if (responseData.success && responseData.imageUrl) {
                    result.innerHTML = '<span class="text-green-600">âœ… NanoBananaService è°ƒç”¨æˆåŠŸ!</span>';
                    log('âœ… å›¾ç‰‡ç”ŸæˆæˆåŠŸ');
                    
                    // æ˜¾ç¤ºç”Ÿæˆçš„å›¾ç‰‡
                    const img = document.createElement('img');
                    img.src = responseData.imageUrl;
                    img.className = 'max-w-full h-auto border rounded-lg shadow-lg mt-4';
                    img.alt = altText;
                    img.onload = () => log('ğŸ–¼ï¸ å›¾ç‰‡æ˜¾ç¤ºæˆåŠŸ');
                    img.onerror = () => log('âŒ å›¾ç‰‡æ˜¾ç¤ºå¤±è´¥');
                    imageContainer.appendChild(img);
                    
                } else {
                    throw new Error(responseData.error || 'æœªè¿”å›å›¾ç‰‡æ•°æ®');
                }
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                result.innerHTML = `<span class="text-red-600">âŒ ${error.message}</span>`;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'ğŸŒ æµ‹è¯• NanoBananaService';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ”„ æµ‹è¯•é¡µé¢å·²åŠ è½½');
            log(`ğŸŒ å½“å‰åŸŸå: ${window.location.origin}`);
        });
    </script>
</body>
</html>