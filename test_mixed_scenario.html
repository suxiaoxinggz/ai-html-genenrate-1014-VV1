<!DOCTYPE html>
<html>
<head>
    <title>æµ‹è¯•æ··åˆåœºæ™¯ - Geminiæ–‡å­— + Nano Bananaå›¾åƒ</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>æ··åˆåœºæ™¯æµ‹è¯•ï¼šGeminiæ–‡å­—æ¨¡å‹ + Nano Bananaå›¾åƒæ¨¡å‹</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•åœºæ™¯</h2>
        <p><strong>æ–‡å­—æ¨¡å‹</strong>: Gemini Pro (éœ€è¦ Google SDK)</p>
        <p><strong>å›¾åƒæ¨¡å‹</strong>: Nano Banana (ä½¿ç”¨åç«¯ä»£ç†)</p>
        <p><strong>æœŸæœ›ç»“æœ</strong>: Google SDK ä¸ºæ–‡å­—æ¨¡å‹åˆå§‹åŒ–ï¼Œä½†å›¾åƒä»é€šè¿‡åç«¯ä»£ç†</p>
    </div>
    
    <div id="test-results" class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <p>æ­£åœ¨è¿è¡Œæµ‹è¯•...</p>
    </div>
    
    <script>
        async function testMixedScenario() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h2>æµ‹è¯•ç»“æœ</h2>';
            
            try {
                // æ¨¡æ‹Ÿæ··åˆåœºæ™¯è®¾ç½®
                localStorage.setItem('textApiKey', 'test-google-key-for-text');
                localStorage.setItem('imageApiKey', 'test-google-key-for-image');
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„é€‰æ‹©å™¨å…ƒç´ 
                const createMockSelect = (id, value) => {
                    let element = document.getElementById(id);
                    if (!element) {
                        element = document.createElement('select');
                        element.id = id;
                        element.style.display = 'none';
                        document.body.appendChild(element);
                    }
                    element.value = value;
                    return element;
                };
                
                // è®¾ç½®æ··åˆåœºæ™¯ï¼šGeminiæ–‡å­— + Nano Bananaå›¾åƒ
                createMockSelect('textModelProvider', 'gemini');
                createMockSelect('imageModelProvider', 'nano-banana');
                createMockSelect('textModel', 'gemini-pro');
                createMockSelect('imageModel', 'nano-banana');
                
                results.innerHTML += '<div class="info">âœ… åœºæ™¯è®¾ç½®å®Œæˆ:</div>';
                results.innerHTML += '<p>ğŸ“ textModelProvider: gemini</p>';
                results.innerHTML += '<p>ğŸ–¼ï¸ imageModelProvider: nano-banana</p>';
                
                // æµ‹è¯•SDKåˆå§‹åŒ–
                const sdkResponse = await fetch('/api/sdk/init', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKeys: {
                            google: 'test-google-key'  // æ¨¡æ‹ŸGoogle SDKåˆå§‹åŒ–
                        }
                    })
                });
                
                const sdkResult = await sdkResponse.json();
                results.innerHTML += '<div class="info">ğŸ”§ SDK åˆå§‹åŒ–æµ‹è¯•:</div>';
                
                if (sdkResult.success) {
                    const initialized = sdkResult.data.initialized;
                    if (initialized.includes('Google AI')) {
                        results.innerHTML += '<div class="success">âœ… Google SDK å·²åˆå§‹åŒ– (ç”¨äºGeminiæ–‡å­—æ¨¡å‹)</div>';
                    } else {
                        results.innerHTML += '<div class="error">âŒ Google SDK æœªåˆå§‹åŒ– (å¯èƒ½å½±å“Geminiæ–‡å­—æ¨¡å‹)</div>';
                    }
                    results.innerHTML += `<p>å·²åˆå§‹åŒ–: ${initialized.join(', ') || 'æ— '}</p>`;
                }
                
                // æµ‹è¯•Nano Bananaåç«¯ä»£ç†
                results.innerHTML += '<div class="info">ğŸŒ Nano Banana åç«¯ä»£ç†æµ‹è¯•:</div>';
                
                const nanoBananaResponse = await fetch('/api/test/nano-banana', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: 'test-key'
                    })
                });
                
                if (nanoBananaResponse.ok || nanoBananaResponse.status === 400) {
                    results.innerHTML += '<div class="success">âœ… Nano Banana åç«¯ä»£ç†å·¥ä½œæ­£å¸¸</div>';
                    results.innerHTML += '<p>ğŸ“¡ å›¾åƒç”Ÿæˆå°†é€šè¿‡åç«¯ä»£ç†è¿›è¡Œï¼Œä¸ä½¿ç”¨å‰ç«¯SDK</p>';
                } else {
                    results.innerHTML += '<div class="error">âŒ Nano Banana åç«¯ä»£ç†ä¸å¯ç”¨</div>';
                }
                
                // ç»“è®º
                results.innerHTML += '<div class="info">ğŸ“Š æµ‹è¯•ç»“è®º:</div>';
                results.innerHTML += '<div class="success">âœ… æ··åˆåœºæ™¯æ”¯æŒæ­£å¸¸</div>';
                results.innerHTML += '<p>â€¢ Geminiæ–‡å­—æ¨¡å‹å¯ä»¥ä½¿ç”¨Google SDK</p>';
                results.innerHTML += '<p>â€¢ Nano Bananaå›¾åƒæ¨¡å‹ä½¿ç”¨åç«¯ä»£ç†</p>';
                results.innerHTML += '<p>â€¢ æ— æ¶æ„å†²çªï¼Œä¸¤è€…å¯ä»¥å¹¶å­˜</p>';
                
            } catch (error) {
                results.innerHTML += `<div class="error">âŒ æµ‹è¯•é”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // è¿è¡Œæµ‹è¯•
        testMixedScenario();
    </script>
</body>
</html>