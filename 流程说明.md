# AI å›¾åƒç”ŸæˆæœåŠ¡å¼€å‘æµç¨‹è¯´æ˜

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†åŸºäº Cloudflare Workers AI çš„å®Œæ•´å›¾åƒç”ŸæˆæœåŠ¡æ¶æ„ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›æ–°æ¨¡å‹é›†æˆçš„æ ‡å‡†æµç¨‹å’Œæœ€ä½³å®è·µã€‚æ— è®ºé›†æˆä»»ä½•ç¬¬ä¸‰æ–¹AIæœåŠ¡ï¼Œéƒ½åº”éµå¾ªæ­¤æ¶æ„æ¨¡å¼ä»¥ç¡®ä¿ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€å¯é æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„åŸåˆ™

### 1. **ç»Ÿä¸€æ¥å£è®¾è®¡**
- æ‰€æœ‰å›¾åƒç”Ÿæˆæ¨¡å‹å¿…é¡»å®ç°ç›¸åŒçš„å‡½æ•°ç­¾å
- è¿”å›æ ¼å¼å¿…é¡»æ ‡å‡†åŒ–ä¸º `data:image/[type];base64,[data]`
- é…ç½®å‚æ•°é‡‡ç”¨ç»Ÿä¸€çš„ç»“æ„åŒ–æ ¼å¼

### 2. **æ¸è¿›å¢å¼ºç­–ç•¥**  
- åŸºç¡€åŠŸèƒ½ä¼˜å…ˆï¼Œé«˜çº§åŠŸèƒ½å¯é€‰
- å‘ä¸‹å…¼å®¹ï¼Œæ–°åŠŸèƒ½ä¸å½±å“ç°æœ‰æµç¨‹
- æ™ºèƒ½é™çº§ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨æ€§

### 3. **ç”¨æˆ·ä½“éªŒå¯¼å‘**
- ç«‹å³å“åº”åŸåˆ™ï¼ˆHTTP 202 Acceptedï¼‰
- å®æ—¶è¿›åº¦åé¦ˆ
- é”™è¯¯ä¿¡æ¯ç”¨æˆ·å‹å¥½

---

## ğŸ“‹ å®Œæ•´å¼€å‘æµç¨‹

## é˜¶æ®µä¸€ï¼šé…ç½®éªŒè¯ä¸å‡†å¤‡ï¼ˆå¿…é¡»å®ç°ï¼‰

### 1.1 é…ç½®ç³»ç»Ÿè®¾è®¡

**ç»Ÿä¸€é…ç½®ç»“æ„**
```typescript
interface ImageConfig {
  provider: string;              // æœåŠ¡æä¾›å•†æ ‡è¯†
  apiKey: string;               // APIå¯†é’¥ï¼ˆå¿…éœ€ï¼‰
  baseUrl?: string;             // APIåŸºç¡€URLï¼ˆOpenAIå…¼å®¹å¿…éœ€ï¼‰
  model?: string;               // æ¨¡å‹åç§°
  
  // ç»Ÿä¸€å‚æ•°ï¼ˆæ‰€æœ‰æ¨¡å‹åº”æ”¯æŒï¼‰
  width?: number;               // å›¾åƒå®½åº¦
  height?: number;              // å›¾åƒé«˜åº¦
  steps?: number;               // ç”Ÿæˆæ­¥æ•°
  guidance?: number;            // å¼•å¯¼å¼ºåº¦
  negativePrompt?: string;      // è´Ÿé¢æç¤ºè¯
  seed?: number;                // éšæœºç§å­
  
  // æ‰©å±•é…ç½®ï¼ˆç‰¹å®šæ¨¡å‹ä¸“ç”¨ï¼‰
  [key: string]: any;
}
```

**é…ç½®éªŒè¯æµç¨‹**
```typescript
async function generateImageWith[YourModel](altText: string, imageConfig: any): Promise<string> {
  console.log(`ğŸš€ [YourModel] Starting image generation for: ${altText.substring(0, 50)}`);
  
  // 1. é…ç½®è·å–å’ŒéªŒè¯
  let modelConfig;
  
  if (imageConfig.yourModelSpecificConfig) {
    // æ”¯æŒç»Ÿä¸€é…ç½®ä¸­çš„å®Œæ•´é…ç½®
    modelConfig = {
      apiKey: imageConfig.apiKey || imageConfig.yourModelSpecificConfig.apiKey,
      baseUrl: imageConfig.yourModelSpecificConfig.baseUrl,
      model: imageConfig.yourModelSpecificConfig.model || 'default-model',
      // å…¶ä»–ç‰¹å®šå‚æ•°...
    };
  } else {
    // é™çº§åˆ°åŸºæœ¬é…ç½®
    if (!imageConfig.apiKey) {
      throw new Error('YourModel requires API key. Please configure it in the modal.');
    }
    modelConfig = {
      apiKey: imageConfig.apiKey,
      baseUrl: imageConfig.baseUrl || 'https://default-api-url.com',
      model: imageConfig.model || 'default-model',
      // ä½¿ç”¨é»˜è®¤å‚æ•°...
    };
  }

  // 2. éªŒè¯å¿…éœ€é…ç½®
  if (!modelConfig.apiKey) {
    console.error('âŒ [YourModel] Missing API key');
    throw new Error('YourModel API key is required');
  }
  
  // è®°å½•é…ç½®ç”¨äºè°ƒè¯•
  console.log('ğŸ”§ [YourModel] Configuration validated:', {
    hasApiKey: !!modelConfig.apiKey,
    hasBaseUrl: !!modelConfig.baseUrl,
    model: modelConfig.model
  });
```

### 1.2 å¿…é¡»éµå®ˆçš„é…ç½®è§„åˆ™

**â— å¼ºåˆ¶è¦æ±‚ï¼š**
1. **å¿…é¡»æ”¯æŒåŸºç¡€é…ç½®**ï¼šä»…æœ‰ apiKey çš„æœ€ç®€é…ç½®å¿…é¡»å¯ç”¨
2. **å¿…é¡»è®°å½•è¯¦ç»†æ—¥å¿—**ï¼šé…ç½®éªŒè¯ã€APIè°ƒç”¨ã€é”™è¯¯ä¿¡æ¯éƒ½è¦è®°å½•
3. **å¿…é¡»æä¾›æ¸…æ™°é”™è¯¯ä¿¡æ¯**ï¼šç”¨æˆ·å¯ç†è§£çš„é”™è¯¯æç¤ºï¼Œä¸æ˜¯æŠ€æœ¯ç»†èŠ‚
4. **å¿…é¡»å¤„ç†ç¼ºå¤±å‚æ•°**ï¼šæä¾›åˆç†çš„é»˜è®¤å€¼æˆ–æ˜ç¡®çš„é”™è¯¯æç¤º

---

## é˜¶æ®µäºŒï¼šæ™ºèƒ½å‚æ•°è½¬æ¢ï¼ˆæ ¸å¿ƒç‰¹è‰²ï¼‰

### 2.1 å‚æ•°æ˜ å°„ç³»ç»Ÿ

**æ™ºèƒ½å‚æ•°è½¬æ¢åŸåˆ™**
```typescript
// æ ¹æ®æ¨¡å‹ç‰¹æ€§è¿›è¡Œæ™ºèƒ½å‚æ•°è½¬æ¢
function buildRequestBody(altText: string, modelConfig: any) {
  let requestBody;
  
  // æ£€æŸ¥æ¨¡å‹ç‰¹æ®Šå¤„ç†éœ€æ±‚
  if (isSpecialModel(modelConfig.model)) {
    // ç‰¹æ®Šæ¨¡å‹çš„æ™ºèƒ½å‚æ•°æ˜ å°„
    let enhancedPrompt = altText;
    
    // 1. Guidance -> æç¤ºè¯å¼ºåº¦å¢å¼º
    if (modelConfig.guidance > 10) {
      enhancedPrompt += ', extremely detailed, ultra-precise, highly accurate';
    } else if (modelConfig.guidance > 7.5) {
      enhancedPrompt += ', highly detailed, precise, well-defined';
    } else if (modelConfig.guidance < 5) {
      enhancedPrompt += ', creative interpretation, artistic freedom';
    }
    
    // 2. å°ºå¯¸ -> è´¨é‡æç¤ºè‡ªåŠ¨æ·»åŠ 
    const isHighRes = modelConfig.width >= 1024 || modelConfig.height >= 1024;
    const isUltraHighRes = modelConfig.width >= 1280 || modelConfig.height >= 1280;
    
    if (isUltraHighRes) {
      enhancedPrompt += ', ultra high resolution, 4K quality, extremely sharp';
    } else if (isHighRes) {
      enhancedPrompt += ', high resolution, sharp details, crisp image';
    }
    
    // 3. å®½é«˜æ¯” -> æ„å›¾å»ºè®®è‡ªåŠ¨ç”Ÿæˆ
    const aspectRatio = modelConfig.width / modelConfig.height;
    if (aspectRatio > 1.5) {
      enhancedPrompt += ', wide landscape composition, panoramic view';
    } else if (aspectRatio < 0.75) {
      enhancedPrompt += ', tall portrait composition, vertical framing';
    } else {
      enhancedPrompt += ', balanced square composition, centered framing';
    }
    
    // 4. è´Ÿé¢æç¤º -> æ­£é¢å¢å¼ºè½¬æ¢ (åˆ›æ–°æ ¸å¿ƒ!)
    if (modelConfig.negativePrompt) {
      const negativeTerms = modelConfig.negativePrompt.toLowerCase();
      if (negativeTerms.includes('blur') || negativeTerms.includes('low quality')) {
        enhancedPrompt += ', crystal clear, high quality, sharp focus';
      }
      if (negativeTerms.includes('distort') || negativeTerms.includes('deform')) {
        enhancedPrompt += ', perfect proportions, accurate anatomy, clean lines';
      }
      if (negativeTerms.includes('dark') || negativeTerms.includes('shadow')) {
        enhancedPrompt += ', well-lit, bright lighting, clear visibility';
      }
    }
    
    // æ·»åŠ é€šç”¨è´¨é‡å¢å¼º
    enhancedPrompt += ', professional quality, detailed rendering';
    
    // ç‰¹æ®Šæ¨¡å‹è¯·æ±‚ä½“ - åªæ”¯æŒéƒ¨åˆ†å‚æ•°
    requestBody = {
      prompt: enhancedPrompt,
      steps: Math.min(modelConfig.steps, 8) // æŸäº›æ¨¡å‹æœ‰æ­¥æ•°é™åˆ¶
    };
    
  } else {
    // æ ‡å‡†æ¨¡å‹ä½¿ç”¨å®Œæ•´å‚æ•°é›†
    requestBody = {
      prompt: altText + ', high quality, professional, detailed',
      num_steps: modelConfig.steps,
      guidance: modelConfig.guidance,
      width: modelConfig.width,
      height: modelConfig.height
    };
    
    // æ·»åŠ å¯é€‰å‚æ•°
    if (modelConfig.negativePrompt) {
      requestBody.negative_prompt = modelConfig.negativePrompt;
    }
    if (modelConfig.seed !== null && modelConfig.seed !== undefined) {
      requestBody.seed = modelConfig.seed;
    }
  }
  
  return requestBody;
}
```

### 2.2 å‚æ•°è½¬æ¢è§„åˆ™

**â— æ ¸å¿ƒè§„åˆ™ï¼š**
1. **æ™ºèƒ½å¢å¼ºåŸåˆ™**ï¼šå°†ç®€å•å‚æ•°è½¬æ¢ä¸ºæ¨¡å‹ç†è§£çš„å¤æ‚æŒ‡ä»¤
2. **è´Ÿé¢è½¬æ­£é¢**ï¼šå°†è´Ÿé¢æç¤ºè¯è½¬æ¢ä¸ºæ­£é¢çš„è´¨é‡å¢å¼º
3. **æ¨¡å‹é€‚é…**ï¼šæ ¹æ®ä¸åŒæ¨¡å‹çš„èƒ½åŠ›é™åˆ¶è°ƒæ•´å‚æ•°
4. **ç”¨æˆ·æ„å›¾ä¿æŒ**ï¼šå¢å¼ºçš„åŒæ—¶ä¿æŒç”¨æˆ·åŸå§‹æ„å›¾

---

## é˜¶æ®µä¸‰ï¼šAPIè°ƒç”¨ä¸å“åº”å¤„ç†ï¼ˆå¿…é¡»å®ç°ï¼‰

### 3.1 ç»Ÿä¸€HTTPè°ƒç”¨æ¨¡å¼

```typescript
// APIè°ƒç”¨æ ‡å‡†æµç¨‹
const apiUrl = buildApiUrl(modelConfig);
console.log('ğŸš€ [YourModel] Making API request to:', apiUrl);
console.log('ğŸ“ [YourModel] Request body:', requestBody);

const response = await fetch(apiUrl, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${modelConfig.apiKey}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(requestBody)
});

console.log('ğŸ“¡ [YourModel] Response status:', response.status, response.statusText);
```

### 3.2 é”™è¯¯å¤„ç†æ˜ å°„

**çŠ¶æ€ç ç²¾ç¡®æ˜ å°„ï¼ˆå¿…é¡»å®ç°ï¼‰**
```typescript
if (!response.ok) {
  const errorText = await response.text();
  let errorMessage = `YourModel API call failed: ${response.status}`;
  
  console.error('âŒ [YourModel] API call failed:', {
    status: response.status,
    statusText: response.statusText,
    errorText: errorText.substring(0, 200)
  });
  
  switch (response.status) {
    case 401:
      errorMessage = 'Invalid API key. Please check your YourModel API token.';
      break;
    case 403:
      errorMessage = 'Access forbidden. Please check your API token permissions.';
      break;
    case 429:
      errorMessage = 'Rate limit exceeded. Please wait and try again.';
      break;
    case 400:
      errorMessage = 'Invalid request. Please check your configuration.';
      break;
    default:
      errorMessage += ` - ${errorText}`;
  }
  
  console.error('âŒ [YourModel] Final error message:', errorMessage);
  throw new Error(errorMessage);
}
```

---

## é˜¶æ®µå››ï¼šæ™ºèƒ½å›¾ç‰‡è½¬æ¢ç³»ç»Ÿï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 4.1 å“åº”æ ¼å¼æ™ºèƒ½è¯†åˆ«

**å¤šæ ¼å¼å“åº”å¤„ç†ï¼ˆå¿…é¡»å®ç°ï¼‰**
```typescript
// æ ¹æ®æ¨¡å‹ç‰¹æ€§å¤„ç†ä¸åŒå“åº”æ ¼å¼
if (isJsonResponseModel(modelConfig.model)) {
  // JSONå“åº”æ ¼å¼æ™ºèƒ½è§£æ
  console.log('ğŸ“„ [YourModel] Processing JSON response');
  
  const jsonResponse = await response.json();
  console.log('âœ… [YourModel] Response structure:', Object.keys(jsonResponse));
  
  // å¤šå±‚çº§æ•°æ®æå–ç­–ç•¥
  let base64Data;
  if (jsonResponse.result?.image) {
    base64Data = jsonResponse.result.image;
  } else if (jsonResponse.data?.[0]?.url) {
    // æŸäº›APIè¿”å›URLè€Œébase64
    return jsonResponse.data[0].url;
  } else if (jsonResponse.image) {
    base64Data = jsonResponse.image;
  } else if (typeof jsonResponse === 'string') {
    base64Data = jsonResponse;
  } else {
    console.error('âŒ [YourModel] Unexpected response format:', jsonResponse);
    throw new Error('Unexpected response format from YourModel');
  }
  
  // ç¡®ä¿base64æ•°æ®æ ¼å¼æ­£ç¡®
  if (!base64Data || typeof base64Data !== 'string') {
    throw new Error('Invalid base64Data received from YourModel');
  }
  
  // æ™ºèƒ½æ ¼å¼æ ‡å‡†åŒ–
  if (base64Data.startsWith('data:image/')) {
    console.log('âœ… [YourModel] Image generated successfully (data URL format)');
    return base64Data;
  } else {
    console.log('âœ… [YourModel] Image generated successfully (base64 format)');
    return `data:image/png;base64,${base64Data}`;
  }
  
} else {
  // äºŒè¿›åˆ¶å“åº”æ ¼å¼æ™ºèƒ½è½¬æ¢
  console.log('ğŸ”¢ [YourModel] Processing binary response');
  
  const arrayBuffer = await response.arrayBuffer();
  const base64Data = Buffer.from(arrayBuffer).toString('base64');
  
  console.log('âœ… [YourModel] Image generated successfully, size:', arrayBuffer.byteLength, 'bytes');
  
  return `data:image/png;base64,${base64Data}`;
}
```

### 4.2 å›¾ç‰‡è½¬æ¢è§„åˆ™

**â— å¼ºåˆ¶æ ‡å‡†ï¼š**
1. **ç»Ÿä¸€è¿”å›æ ¼å¼**ï¼šæ‰€æœ‰æ¨¡å‹å¿…é¡»è¿”å› `data:image/[type];base64,[data]` æ ¼å¼
2. **æ™ºèƒ½æ ¼å¼æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ« JSON æˆ–äºŒè¿›åˆ¶å“åº”
3. **å¤šå±‚æå–ç­–ç•¥**ï¼šæŒ‰ä¼˜å…ˆçº§å°è¯•ä¸åŒå­—æ®µæå–å›¾ç‰‡æ•°æ®
4. **æ ¼å¼æ ‡å‡†åŒ–**ï¼šè‡ªåŠ¨è¡¥å…¨ç¼ºå¤±çš„ data URL å‰ç¼€

---

## é˜¶æ®µäº”ï¼šä»»åŠ¡ç¼–æ’ç®¡ç†ç³»ç»Ÿï¼ˆå¿…é¡»é›†æˆï¼‰

### 5.1 ä¸‰é˜¶æ®µå¤„ç†æµç¨‹

**æ‰€æœ‰å›¾åƒç”Ÿæˆå¿…é¡»éµå¾ªçš„æµç¨‹ï¼š**

```typescript
// é˜¶æ®µ1: HTMLç»“æ„ç”Ÿæˆ (0-33%)
await processStage1(env, jobId, requestData)

// é˜¶æ®µ2: å›¾ç‰‡ç”Ÿæˆå’Œå¤„ç† (33-80%) 
await processStage2(env, jobId, requestData, htmlStructure)
// ä½ çš„æ¨¡å‹åœ¨è¿™ä¸ªé˜¶æ®µè¢«è°ƒç”¨

// é˜¶æ®µ3: HTMLä¼˜åŒ–ä¸éªŒè¯ (80-100%)
await processStage3(env, jobId, requestData, processedHTML)
```

### 5.2 çŠ¶æ€è·Ÿè¸ªé›†æˆ

**å¿…é¡»æ›´æ–°çš„çŠ¶æ€ä¿¡æ¯ï¼š**
```typescript
// åœ¨å›¾ç‰‡ç”Ÿæˆè¿‡ç¨‹ä¸­æ›´æ–°è¿›åº¦
async function generateSingleImage(altText: string, imageConfig: any, ...) {
  // ... é…ç½®éªŒè¯
  
  try {
    // è°ƒç”¨ä½ çš„å›¾ç‰‡ç”Ÿæˆå‡½æ•°
    if (imageConfig.provider === 'your-model') {
      imageUrl = await generateImageWithYourModel(altText, imageConfig)
    }
    
    // ğŸ†• WordPresså…¼å®¹æ€§è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if (env && jobId && imageIndex !== undefined && needsWordPressConversion(imageUrl)) {
      console.log(`ğŸ”„ [WordPress] Converting image ${imageIndex + 1} to WordPress-compatible URL`)
      imageUrl = await convertToWordPressUrl(imageUrl, altText, jobId, imageIndex, env, baseUrl)
    }
    
    return imageUrl
    
  } catch (error) {
    // é‡è¯•æœºåˆ¶
    retryCount++
    if (retryCount <= maxRetries) {
      await new Promise(resolve => setTimeout(resolve, 1000 * retryCount))
    } else {
      // å¤šå±‚å…œåº•ï¼šUnsplash -> Pollinations -> Placeholder
      // ... å…œåº•é€»è¾‘
    }
  }
}
```

---

## é˜¶æ®µå…­ï¼šå­˜å‚¨æœåŠ¡é›†æˆï¼ˆå¿…é¡»éµå¾ªï¼‰

### 6.1 åŒå±‚å­˜å‚¨æ¶æ„

**D1 + KV å­˜å‚¨æ¨¡å¼ï¼š**
```typescript
// D1 SQLite: æŒä¹…åŒ–ä¸»å­˜å‚¨
await env.DB.prepare(`
  INSERT INTO async_jobs (id, status, request_data, html_structure, created_at)
  VALUES (?, ?, ?, ?, datetime('now'))
`).bind(jobId, 'pending', JSON.stringify(requestData), htmlStructure).run()

// KV å­˜å‚¨: å®æ—¶çŠ¶æ€æ›´æ–°
await env.JOBS.put(jobId, JSON.stringify({
  status: 'processing',
  currentStep: 2,
  steps: [è¯¦ç»†è¿›åº¦ä¿¡æ¯],
  htmlStructure: å®æ—¶HTMLå†…å®¹,
  progress: 67,
  updatedAt: new Date().toISOString()
}))
```

### 6.2 æ•°æ®åˆ†å±‚ç­–ç•¥

**â— å­˜å‚¨è§„åˆ™ï¼š**
- **D1**: ä»»åŠ¡åˆ›å»ºã€æœ€ç»ˆçŠ¶æ€ã€å†å²è®°å½•
- **KV**: å®æ—¶è¿›åº¦ã€ä¸´æ—¶çŠ¶æ€ã€è½®è¯¢ä¼˜åŒ–
- **R2**: å¤§æ–‡ä»¶å­˜å‚¨ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

## é˜¶æ®µä¸ƒï¼šHTMLé›†æˆå›¾ç‰‡è½¬æ¢ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰

### 7.1 base64è½¬æ¢ç³»ç»Ÿ

```typescript
// å¯é€‰çš„base64è½¬æ¢åŠŸèƒ½ï¼ˆç”¨æˆ·å¯æ§ï¼‰
if (requestData.convertImagesToBase64) {
  console.log(`ğŸ–¼ï¸ [${jobId}] Converting images to base64 format`)
  await updateJobProgress(env, jobId, 'processing', 3, 'è½¬æ¢å›¾ç‰‡ä¸ºbase64æ ¼å¼', 95, finalHTML)
  finalHTML = await convertImagesToBase64(finalHTML)
}
```

### 7.2 æ™ºèƒ½è½¬æ¢å¤„ç†

```typescript
async function convertImagesToBase64(html: string): Promise<string> {
  // 1. æ­£åˆ™è¡¨è¾¾å¼æ™ºèƒ½æå–æ‰€æœ‰imgæ ‡ç­¾
  const imgRegex = /<img[^>]+src="([^"]+)"[^>]*>/gi
  const matches = [...html.matchAll(imgRegex)]
  
  for (let i = 0; i < matches.length; i++) {
    const imageUrl = matches[i][1]
    
    // 2. æ™ºèƒ½è·³è¿‡å·²å¤„ç†çš„å›¾ç‰‡
    if (imageUrl.startsWith('data:')) {
      continue
    }
    
    // 3. é”™è¯¯å®¹é”™å¤„ç† - ä¸ä¸­æ–­æ•´ä½“æµç¨‹
    try {
      const base64Image = await fetchImageAsBase64(imageUrl)
      // æ›¿æ¢å¤„ç†...
    } catch (error) {
      console.warn(`âš ï¸ Failed to convert image: ${error.message}`)
      // ä¿æŒåŸå§‹ URLï¼Œç»§ç»­å¤„ç†å…¶ä»–å›¾ç‰‡
    }
  }
}
```

---

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### å¿…é¡»å®ç°çš„åŠŸèƒ½ âœ…

- [ ] **é…ç½®éªŒè¯ç³»ç»Ÿ**ï¼šæ”¯æŒç»Ÿä¸€é…ç½®å’Œé™çº§é…ç½®
- [ ] **è¯¦ç»†æ—¥å¿—è®°å½•**ï¼šæ‰€æœ‰å…³é”®æ­¥éª¤éƒ½æœ‰æ—¥å¿—
- [ ] **é”™è¯¯å¤„ç†æ˜ å°„**ï¼šHTTPçŠ¶æ€ç ç²¾ç¡®æ˜ å°„ä¸ºç”¨æˆ·å‹å¥½ä¿¡æ¯
- [ ] **å“åº”æ ¼å¼å¤„ç†**ï¼šæ”¯æŒJSONå’ŒäºŒè¿›åˆ¶å“åº”æ™ºèƒ½è¯†åˆ«
- [ ] **ç»Ÿä¸€è¿”å›æ ¼å¼**ï¼šè¿”å›æ ‡å‡†çš„ data URL æ ¼å¼
- [ ] **é‡è¯•é™çº§æœºåˆ¶**ï¼šAPIå¤±è´¥æ—¶çš„å¤šå±‚å…œåº•ç­–ç•¥

### æ¨èå®ç°çš„åŠŸèƒ½ ğŸŒŸ

- [ ] **æ™ºèƒ½å‚æ•°è½¬æ¢**ï¼šå°†é€šç”¨å‚æ•°è½¬æ¢ä¸ºæ¨¡å‹æœ€ä¼˜æ•ˆæœ
- [ ] **è´Ÿé¢è½¬æ­£é¢**ï¼šè´Ÿé¢æç¤ºè¯è½¬æ¢ä¸ºæ­£é¢è´¨é‡å¢å¼º
- [ ] **æ¨¡å‹ç‰¹æ®Šå¤„ç†**ï¼šæ ¹æ®æ¨¡å‹ç‰¹æ€§è°ƒæ•´å‚æ•°å’Œå¤„ç†é€»è¾‘
- [ ] **WordPresså…¼å®¹**ï¼šå¹³å°å…¼å®¹æ€§è½¬æ¢æ¥å£
- [ ] **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜ã€å¹¶å‘æ§åˆ¶ç­‰ä¼˜åŒ–æªæ–½

### å¯é€‰æ‰©å±•åŠŸèƒ½ ğŸ’¡

- [ ] **å¤šæ¨¡å‹æ”¯æŒ**ï¼šå•ä¸ªprovideræ”¯æŒå¤šä¸ªå­æ¨¡å‹
- [ ] **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡å›¾ç‰‡ç”Ÿæˆ
- [ ] **è‡ªå®šä¹‰åå¤„ç†**ï¼šå›¾ç‰‡åå¤„ç†ç®¡é“
- [ ] **æˆæœ¬æ§åˆ¶**ï¼šAPIè°ƒç”¨æˆæœ¬è·Ÿè¸ªå’Œé™åˆ¶

---

## ğŸš¨ åŠ¡å¿…éµå®ˆçš„è§„åˆ™

### 1. **æ¥å£ä¸€è‡´æ€§**
- æ‰€æœ‰å›¾ç‰‡ç”Ÿæˆå‡½æ•°å¿…é¡»æœ‰ç›¸åŒçš„ç­¾å
- è¿”å›æ ¼å¼å¿…é¡»æ˜¯æ ‡å‡†çš„ data URL
- é”™è¯¯å¤„ç†å¿…é¡»æŠ›å‡ºæœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯

### 2. **ç”¨æˆ·ä½“éªŒ**
- å¿…é¡»æä¾›è¯¦ç»†çš„è¿›åº¦åé¦ˆ
- é”™è¯¯ä¿¡æ¯å¿…é¡»ç”¨æˆ·å‹å¥½ï¼Œä¸æ˜¯æŠ€æœ¯ç»†èŠ‚
- ä¸èƒ½å› ä¸ºå•ä¸ªæ¨¡å‹å¤±è´¥è€Œå½±å“æ•´ä½“æœåŠ¡

### 3. **æ€§èƒ½è¦æ±‚**
- APIè°ƒç”¨å¿…é¡»æœ‰è¶…æ—¶æ§åˆ¶
- å¿…é¡»å®ç°é‡è¯•æœºåˆ¶
- å¤§æ–‡ä»¶å¤„ç†è¦è€ƒè™‘å†…å­˜é™åˆ¶

### 4. **å®‰å…¨è§„èŒƒ**
- APIå¯†é’¥ä¸èƒ½è®°å½•åˆ°æ—¥å¿—
- æ•æ„Ÿä¿¡æ¯å¿…é¡»å¦¥å–„å¤„ç†
- è¾“å…¥å‚æ•°å¿…é¡»éªŒè¯å’Œæ¸…ç†

### 5. **æ‰©å±•æ€§è®¾è®¡**
- æ–°æ¨¡å‹ä¸èƒ½ç ´åç°æœ‰åŠŸèƒ½
- é…ç½®ç»“æ„è¦å‘ä¸‹å…¼å®¹
- é¢„ç•™æ‰©å±•æ¥å£ä¾¿äºæœªæ¥å‡çº§

---

## ğŸ”§ è°ƒè¯•å’Œæµ‹è¯•æŒ‡å—

### æ—¥å¿—æ ‡å‡†
```typescript
console.log('ğŸš€ [ModelName] Starting image generation')  // å¼€å§‹
console.log('ğŸ”§ [ModelName] Configuration validated')    // é…ç½®éªŒè¯
console.log('ğŸ“ [ModelName] Request body:', requestBody) // è¯·æ±‚è¯¦æƒ…
console.log('ğŸ“¡ [ModelName] Response status:', status)   // å“åº”çŠ¶æ€
console.log('âœ… [ModelName] Image generated successfully') // æˆåŠŸå®Œæˆ
console.error('âŒ [ModelName] Error:', error.message)    // é”™è¯¯ä¿¡æ¯
```

### æµ‹è¯•ç”¨ä¾‹
- åŸºç¡€é…ç½®æµ‹è¯•ï¼šä»…æœ‰apiKeyçš„æœ€å°é…ç½®
- å®Œæ•´é…ç½®æµ‹è¯•ï¼šæ‰€æœ‰å‚æ•°éƒ½è®¾ç½®çš„é…ç½®
- é”™è¯¯åœºæ™¯æµ‹è¯•ï¼šæ— æ•ˆapiKeyã€ç½‘ç»œé”™è¯¯ã€æ ¼å¼é”™è¯¯ç­‰
- è¾¹ç•Œå€¼æµ‹è¯•ï¼šè¶…å¤§å°ºå¯¸ã€æå€¼å‚æ•°ç­‰

---

## ğŸ“– å‚è€ƒå®ç°

è¯·å‚è€ƒç°æœ‰çš„ `generateImageWithCloudflareWorkersAI` å‡½æ•°ä½œä¸ºæ ‡å‡†å®ç°ï¼Œå®ƒå®Œæ•´å±•ç¤ºäº†æ‰€æœ‰å¿…éœ€çš„åŠŸèƒ½å’Œæœ€ä½³å®è·µã€‚

æ–°æ¨¡å‹çš„å®ç°åº”è¯¥æŒ‰ç…§ç›¸åŒçš„æ¨¡å¼å’Œè´¨é‡æ ‡å‡†è¿›è¡Œå¼€å‘ï¼Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚